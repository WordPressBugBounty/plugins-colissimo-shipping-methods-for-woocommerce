(()=>{"use strict";const e=window.React,t=window.wp.element,c=window.wp.plugins,l=window.wc.blocksCheckout,n=window.wp.data,o=({cart:c,context:l})=>{if("woocommerce/checkout"!==l)return null;const[o,i]=(0,t.useState)(!1),[r,s]=(0,t.useState)(),{setValidationErrors:d,clearValidationError:p}=(0,n.useDispatch)("wc/store/validation"),{phone:u,country:m,address_1:_,postcode:f,city:y}=c.shippingAddress;window.lpcBlockChangeContent=e=>{s(e)};let h="";null!=c?.shippingRates[0]&&c?.shippingRates[0]?.shipping_rates.forEach((e=>{h=!0===e.selected?e.method_id:h})),(0,t.useEffect)((()=>{"undefined"==typeof lpcPickUpSelection||o||"lpc_relay"!==h||(i(!0),jQuery.ajax({url:lpcPickUpSelection.baseAjaxUrl,type:"POST",dataType:"json",data:{action:"lpc_pickup_ajax_content"},success:function(e){"success"===e.type&&e.data.content!==r&&s(e.data.content)},complete:function(e){i(!1)}}))}),[c?.shippingRates,r]),(0,t.useEffect)((()=>{h&&"lpc_relay"===h&&"undefined"!=typeof lpcPickUpSelection&&(((e,t)=>{if(!e)return!1;if("BE"!==t)return!0;const c=e.replace(/\s/g,"");if(!c.match(/^\+324\d{8}$/))return!1;const l=c.split("").reverse().map((e=>parseInt(e,10)));let n=!0,o=!0,a=!0;for(let e=0;e<l.length&&7!==e;e++)l[e+1]!==l[e]-1&&(n=!1),l[e+1]!==l[e]+1&&(o=!1),l[e+1]!==l[e]&&(a=!1);return!n&&!o&&!a})(u,m)?r&&!r.includes('<div id="lpc_pick_up_info"></div>')?p("lpc_validation"):d({lpc_validation:{message:lpcPickUpSelection.messagePickupRequired,hidden:!1}}):d({lpc_validation:{message:lpcPickUpSelection.messagePhoneRequired,hidden:!1}}))}),[p,d,r,c.shippingAddress.phone,c.shippingAddress.country,c?.shippingRates]);const{validationError:g}=(0,n.useSelect)((e=>({validationError:e("wc/store/validation").getValidationError("lpc_validation")})));return"lpc_relay"!==h?(g&&p("lpc_validation"),null):(jQuery("[data-lpc-template]").off("click").on("click",(function(e){e.preventDefault(),a({template:jQuery(this).attr("data-lpc-template")}),jQuery(this).is("[data-lpc-callback]")&&window[jQuery(this).attr("data-lpc-callback")](jQuery(this))})),jQuery(".lpc_pick_up_widget_show_map").off("click").on("click",(function(e){e.preventDefault(),$affectMethodDiv=jQuery(this).closest(".lpc_order_affect_available_methods"),a({template:"lpc_pick_up_widget_container"});const t={callBackFrame:"lpc_callback"};jQuery.extend(t,window.lpc_widget_info),t.ceAddress=_.replace(/’/g,"'"),t.ceZipCode=f.replace(/[^0-9]/g,""),t.ceTown=y.replace(/’/g,"'"),t.ceCountry=m,jQuery("#lpc_widget_container").frameColissimoOpen(t),jQuery(".lpc-modal .modal-close").on("click",(function(){let e=jQuery("#lpc_widget_container");if(e.length>0)try{e.frameColissimoClose()}catch(e){console.error(e)}}))})),(0,e.createElement)("div",{id:"lpc_gutenberg_block_container"},(0,e.createElement)("div",{dangerouslySetInnerHTML:{__html:r}}),!1===g?.hidden&&(0,e.createElement)("div",null,"⚠️ ",g?.message)))};function a(e){e.template||console.error("Could not instantiate modal without template");const t=`lpc-modal${e.template}`;let c=document.getElementById(t);if(c)c.style.display="block";else{const l=document.getElementById(`tmpl-${e.template}`);l||console.error("Error while getting the template of the modal"),document.body.insertAdjacentHTML("beforeend",`<div id="${t}">${l.innerHTML}</div>`),c=document.getElementById(t)}const l=c.querySelectorAll(".modal-close");for(const e of l)e.addEventListener("click",(function(e){e.preventDefault(),c.style.display="none"}))}const i=({cart:c,context:l})=>{if("woocommerce/checkout"!==l)return null;const[n,o]=(0,t.useState)(!1),[a,i]=(0,t.useState)(""),{country:r,postcode:s}=c.shippingAddress;return(0,t.useEffect)((()=>{n||(jQuery(".lpc_delivery_date_info").remove(),s.length<5||"FR"!==r||(o(!0),jQuery.ajax({url:lpc_baseAjaxUrl,type:"POST",dataType:"json",data:{action:"lpc_checkout_delivery_date",postcode:s},success:function(e){"success"===e.type&&(jQuery(".lpc_delivery_date_info").remove(),jQuery('input[value^="lpc_"]').each((function(){jQuery(this).closest("label").find(".wc-block-components-radio-control__option-layout").append(`<div class="lpc_delivery_date_info">${e.data.deliveryDateText}</div>`)})),i(e.data.deliveryDateText))},complete:function(){o(!1)}})))}),[s]),(0,e.createElement)(e.Fragment,null)};(0,c.registerPlugin)("lpc-wc-block",{render:()=>(0,e.createElement)(e.Fragment,null,(0,e.createElement)(l.ExperimentalOrderShippingPackages,null,(0,e.createElement)(o,null),(0,e.createElement)(i,null))),scope:"woocommerce-checkout"})})();